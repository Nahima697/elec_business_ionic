<ion-header [translucent]="true" class="ion-no-border shadow-none">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/user" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Mon Profil</ion-title>
    <ion-buttons slot="end">
      <ion-button color="danger" (click)="logout()">
        <ion-icon slot="icon-only" name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-gray-50">
  @if (isLoading()) {
  <div class="flex justify-center items-center h-full">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
  </div>
  } @else {

  <div class="flex flex-col items-center pt-8 pb-6 bg-white shadow-sm mb-4">
    <div class="relative">
      <ion-avatar class="w-24 h-24 border-4 border-white shadow-md"(click)="changeProfilePicture()">
        <img
          [src]="user()?.profilePictureUrl || 'assets/images/default-avatar.png'"
          alt="Avatar"
        />
      </ion-avatar>
      <button
        class="absolute bottom-0 right-0 bg-primary text-white p-1.5 rounded-full shadow-lg"
      >
        <ion-icon name="camera-outline" class="text-lg"></ion-icon>
      </button>
    </div>
    <h2 class="mt-3 text-xl font-bold text-gray-800">{{ user()?.username }}</h2>
    <p class="text-sm text-gray-500">{{ user()?.email }}</p>
  </div>

  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="px-4 pb-10">
    <div class="mb-6">
      <h3 class="text-sm uppercase font-bold text-gray-500 mb-2 pl-2">
        Infos personnelles
      </h3>
      <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <ion-item lines="full">
          <ion-label position="stacked" class="text-gray-500"
            >Nom d'utilisateur</ion-label
          >
          <ion-input
            formControlName="username"
            type="text"
            placeholder="Votre pseudo"
          ></ion-input>
        </ion-item>
        <ion-item lines="none">
          <ion-label position="stacked" class="text-gray-500">Email</ion-label>
          <ion-input
            formControlName="email"
            type="email"
            class="text-gray-400"
          ></ion-input>
        </ion-item>
      </div>
    </div>

    <div class="mb-8">
      <h3 class="text-sm uppercase font-bold text-gray-500 mb-2 pl-2">
        Adresse de facturation
      </h3>
      <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <ion-item lines="full">
          <ion-label position="stacked" class="text-gray-500"
            >Adresse</ion-label
          >
          <ion-input
            formControlName="addressLine"
            placeholder="12 rue de la Paix"
          ></ion-input>
        </ion-item>

        <div class="flex">
          <ion-item lines="full" class="w-1/2 border-r border-gray-100">
            <ion-label position="stacked" class="text-gray-500"
              >Code Postal</ion-label
            >
            <ion-input
              formControlName="postalCode"
              placeholder="75000"
            ></ion-input>
          </ion-item>
          <ion-item lines="full" class="w-1/2">
            <ion-label position="stacked" class="text-gray-500"
              >Ville</ion-label
            >
            <ion-input formControlName="city" placeholder="Paris"></ion-input>
          </ion-item>
        </div>

        <ion-item lines="none">
          <ion-label position="stacked" class="text-gray-500">Pays</ion-label>
          <ion-input formControlName="country" placeholder="France"></ion-input>
        </ion-item>
      </div>
    </div>

    <ion-button
      expand="block"
      type="submit"
      [disabled]="profileForm.invalid || isSaving()"
      class="h-12 font-bold shadow-lg"
    >
      @if(isSaving()) {
      <ion-spinner name="dots"></ion-spinner>
      } @else { Enregistrer les modifications }
    </ion-button>
  </form>
  }
</ion-content>
